---
output:
  revealjs::revealjs_presentation:
    transition: fade
    css: www/revealjs.css
    incremental: TRUE
    reveal_options:
      slideNumber: TRUE
      previewLinks: TRUE
editor_options:
  chunk_output_type: console
---

```{r setup, echo = FALSE}
library(knitr)
library(SASmarkdown)
opts_chunk$set(message = FALSE)
opts_chunk$set(warning = FALSE)
opts_chunk$set(fig.align = "center")

```
# <font color="#ffffff">Intro to SAS Macros</font> {data-background=#1696d2}

Leah Durbak

```{r, echo=FALSE, out.width = "50%"}
knitr::include_graphics("www/images/urban_grid_elevate_white_blue.png")
```

## Overview
1) Explain what the SAS macro facility is, why you want to employ it, and how it works
2) Walk through examples of using macro in SAS code
3) List tips/tricks/common stumbling blocks for using SAS macros
4) List resources where you can learn more

# <font color="#ffffff">What is the SAS Macro Facility?</font> {data-background=#1696d2}

## Text processing facility used for
>- symbolic substitution 
```{r, engine='sas', engine.path="C:/Program Files/SASHome/SASFoundation/9.4/sas.exe", engine.opts="-nosplash -linesize 75", comment=""}
proc print data=sashelp.baseball (obs=10);
	var Name;
	where nAtBat > 600;
	title "Players with at Bats over 600";
	title "Created 10:24 Monday, 17JUL2019";
run;
```
    
## Text processing facility used for
>- symbolic substitution 
>- automated production
```{r, engine='sas', engine.path="C:/Program Files/SASHome/SASFoundation/9.4/sas.exe", engine.opts="-nosplash -linesize 75", comment=""}
proc freq data=sashelp.baseball;
	title "Positions of Players with at Bats over 600";
	table Position;
	where nAtBat > 600;
run;
proc means data=sashelp.baseball;
	title "Home Run N Distributions for Players with at Bats over 600 by League";
	where nAtBat > 600;
	class League;
	var nHome;
run;
```

## Text processing facility used for
>- symbolic substitution 
>- automated production
>- conditional construction 

<p style="font-family: courier; font-size:14pt">

    Is it Friday? 
    If no, run this report:
      proc print data=sashelp.baseball (obs=10);
      run;
    If yes, run this report:
      proc means data=sashelp.baseball (obs=10);
      run;
    
</p>

## Text processing facility used for
>- symbolic substitution 
>- automated production
>- conditional construction 
>- dynamic generation of code
<p style="font-family: courier; font-size:14pt">

    proc print data=dat.yearly_summary_2015;
    run;
    proc print data=dat.yearly_summary_2016;
    run;
    proc print data=dat.yearly_summary_2017;
    run;
    
</p>

# <font color="#ffffff">Why use macros?</font> {data-background=#1696d2}

## Efficiency 
Macros will help reduce code development and maintenance time (especially for code that will be run over many months, cities, etc.)

  - How? 
    - Develop working code without macro coding 
    - Replace hardcoded values with macro (where possible)
    - Add condition/iterative processing with macros (where possible)   
  - Run your code over and over again, adjusting macro values as needed
    - I.e. relatively small changes to use your code over a wide variety of scenarios
  
# <font color="#ffffff">How do macros work?</font> {data-background=#1696d2}

## Program Flow 
It's important to this part because 97% of the problems you are going to have with macros is going to have to do with timing.

When you submit code within the SAS, it is copied to a memory location called the input stack. 

## Program Flow 
In the input stack, the **word scanner** reads the text from left to right and recognizes **tokens**. Tokens end when the word scanner encounters a space or the beginning of another token.

<font size="6">

- Name tokens: contain one or more characters beginning with a letter/underscore and contain letters, underscores, or numerials 
- Special tokens: any character(s) other than a letter, underscore, or numeral (ie. ;)
- Literal tokens: a string of characters encolsed in single ('') or double ("") quotation marks
- Number tokens: interger or floating-point numbers contain a decimal point, exponent, or both (including dates)

</font size>

## Program Flow
<font size="6">
The word scanner recognizes two macro triggers that begin with two token sequencies:

<font size="5">

  &name-token: a macro variable
  
  %name-token: a macro statement, function, or call
    
</font size>

When the word scanner encounters one of these two triggers, it immediately sends the macro to the macro processor
</font size>

<font size="5">

>- everything following the macro trigger is sent to the macro processor until a semicolon is encountered
>- the macro processor resolves the macro language statement

</font size>
```{r, echo=FALSE, out.width = "50%"}
knitr::include_graphics("www/images/programflow.png")
``` 
    
## End of slides (for now)

The rest of this session will follow the SAS program included with today's materials on Git. 

<font size="6">

>- Start SAS
>   - SAS Studio  - https://uint.urban.org/sasusers/index.html#sas-studio 
>- Get session materials from Git
https://github.com/UI-Research/AdvancedSAS 
>   - Click on “intro_to_macros_20190723.sas”
>     - Click on “raw” button in top right of code block
>     - Copy and paste the SAS code into your SAS environment
>   - Download the SAS datasets (demo, hdrs, lns)
>   - Other materials:
>     - These slides
</font size>


# <font color="#ffffff">Resources</font> {data-background=#1696d2}

## SAS Sessions
>- Combining SAS Macros and PROC SQL 
>   - Even more automation of dynamic code! 
>   - Tuesday, August 6th, 12-1pm
>   - Same room (Learning and Community Hub, 3030)
>   - Email ldurbak@urban.org if you don’t have an invite!
>- Using Github on SAS1
>   - Version control for SAS programs on SAS1 server (never lose overwritten code again!)
>   - Date/time TBD

## SAS Users Group Resources
>- SAS Users Group website: https://uint.urban.org/sasusers/index.html  (or search “SAS users group” on the intranet)
>   - Getting started 
>   - Bootcamp
>   - Brownbags
>     - Including this one!
>   - UI Guide to SAS 
>   - Links to SAS Institute Training
>   - Git Hub 

